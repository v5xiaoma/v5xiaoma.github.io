<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="学习,服务器,linux," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。">
<meta property="og:type" content="article">
<meta property="og:title" content="linux基础知识整理">
<meta property="og:url" content="http://v5xiaoma.github.io/2016/05/29/linux基础知识整理/index.html">
<meta property="og:site_name" content="v5xiaoma">
<meta property="og:description" content="Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。">
<meta property="og:updated_time" content="2016-05-29T09:44:06.302Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux基础知识整理">
<meta name="twitter:description" content="Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> linux基础知识整理 | v5xiaoma </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?1d7690bedd35d6a3f23619e6efd6ef5e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">v5xiaoma</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'M3ktvtzhYB5g5z2tyyAc','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                linux基础知识整理
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-29T08:44:57+08:00" content="2016-05-29">
              2016-05-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/服务器/" itemprop="url" rel="index">
                    <span itemprop="name">服务器</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/服务器/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/29/linux基础知识整理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/29/linux基础知识整理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/29/linux基础知识整理/" class="leancloud_visitors" data-flag-title="linux基础知识整理">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。</p>
<a id="more"></a>
<h1 id="快捷操作"><a href="#快捷操作" class="headerlink" title="快捷操作"></a>快捷操作</h1><ul>
<li><strong>tab</strong> <em>自动补齐，当有多个选择时按两次tab会出现列表</em></li>
<li><strong>ctrl+d</strong> <em>退出当前操作</em></li>
<li><strong>ctrl+c</strong> <em>停止当前执行的命令</em></li>
</ul>
<h1 id="系统命令"><a href="#系统命令" class="headerlink" title="系统命令"></a>系统命令</h1><ul>
<li><strong>立刻关机</strong> <code>shutdown –h now</code></li>
<li><strong>15：30分关机</strong> <code>shutdown –h 15:30</code></li>
<li><strong>30分钟后关机</strong> <code>shutdown –h +20</code></li>
<li><strong>20分钟后重启,提示System will reboot</strong> <code>shutdown –r +20 &quot;System will reboot&quot;</code></li>
<li><strong>忘记Root管理员密码</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">系统起动时，随便按一个键进入grub菜单</span><br><span class="line">按e键进入编辑模式</span><br><span class="line">移入kernel行，按e继续编辑</span><br><span class="line">在最后面输入( single)+回车</span><br><span class="line">按b引导系统进入单用户模式</span><br><span class="line">执行passwd命令，输入新密码</span><br><span class="line">重起电脑 reboot</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h1><ul>
<li><strong>当前目录</strong> <code>. ./</code></li>
<li><strong>上级目录</strong> <code>.. ../</code></li>
<li><strong>上一个工作目录</strong> <code>-</code></li>
<li><strong>家目录(宿主目录)</strong> <code>~</code></li>
<li><strong>返回上级目录</strong> <code>cd ..</code></li>
<li><strong>切换目录</strong> <code>cd</code></li>
<li><strong>进入hdxj用户宿主目录</strong> <code>cd ~aa</code></li>
<li><strong>返回当前用户家目录</strong> <code>cd=cd ~</code></li>
<li><strong>进入根下tmp目录</strong> <code>cd /tmp</code></li>
<li><strong>显示当前目录</strong> <code>ls .</code></li>
<li><strong>显示目录内容</strong> <code>ls</code></li>
<li><strong>包含隐藏文件</strong> <code>ls -a</code></li>
<li><strong>列出文件详细信息如属性与权限信息</strong> <code>ls -l</code></li>
<li><strong>以容易识别的单位显示如GB/MB/KB</strong> <code>ls –lh</code></li>
<li><strong>递归删除目录</strong> <code>rm –r h</code></li>
<li><strong>不用确认的删除操作</strong> <code>rm –rf h</code></li>
</ul>
<h1 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h1><ul>
<li><strong>创建空文件</strong> <code>touch</code></li>
<li><strong>在宿主目录创建houdunwang目录</strong> <code>mkdir h</code></li>
<li><strong>递归创建目录</strong> <code>mkdir –p /a/b/c</code></li>
<li><strong>删除文件hd.php</strong> <code>rm hd.php</code></li>
<li><strong>递归删除目录</strong> <code>rm –r h</code></li>
<li><strong>不用确认的删除操作</strong> <code>rm –rf h</code></li>
<li><strong>复制文件hdphp到tmp目录</strong> <code>cp hdphp /tmp/hdphp</code></li>
<li><strong>a1.txt与a2.txt复制到/tmp目录</strong> <code>cp a1.txt a2.txt tmp</code></li>
<li><strong>复制以hdphp开始以.php结果的文件到/tmp目录</strong> <code>cp hdphp*.php /tmp</code></li>
<li><strong>为index.php文件创建软链接index_link.php到tmp目录下</strong> <code>ln –s /home/hdxj/index.php /tmp/index_link.php</code></li>
<li><strong>创建hdxj.php硬链接到/tmp/hdxj.bak.php</strong> <code>ln /home/hdxj/hdxj.php /tmp/hdxj.bak.php</code></li>
<li><strong>删除hdphp文件</strong> <code>rm hdphp</code></li>
<li><strong>文件不存在不报错</strong> <code>rm –f hdphp</code></li>
<li><strong>递归删除(删除目录)</strong> <code>rm –r hdphp</code></li>
<li><strong>将hdphp改名为hd</strong> <code>mv hdphp hd</code></li>
<li><strong>移动hdphp文件到/tmp中</strong> <code>mv hdphp /tmp</code></li>
<li><strong>显示前2行head</strong> <code>head –n 2 /etc/passwd</code></li>
<li><strong>取后5行内容tail</strong> <code>tail –n 5 index.php</code></li>
<li><strong>显示文件内容</strong> <code>cat index.php</code></li>
<li><strong>显示文件内容带行号</strong> <code>cat –n index.php</code></li>
<li><strong>分屏显示文件内容more</strong> <code>more /etc/passwd</code></li>
<li><strong>退出显示</strong> <code>more q</code></li>
<li><strong>显示包含houdunwang的行</strong> <code>grep &#39;houdunwang&#39; hd.php</code></li>
<li><strong>显示所有非注释行</strong> <code>grep –v “^\s*[#;]”/etc/samba/smb.conf</code></li>
<li><strong>显示不包含匹配文本的所有行</strong> <code>grep -v</code></li>
<li><strong>显示匹配行及 行号</strong> <code>grep -n</code></li>
<li><strong>不区分大小</strong> <code>grep -i</code></li>
<li><strong>查找passwd命令所在位置</strong> <code>which passwd</code></li>
<li><strong>查找文件名为passwd的文件</strong> <code>whereis passwd</code></li>
<li><strong>查找文件名为index.php的文件</strong> <code>find / -name index.php</code></li>
<li><strong>查找大于10Mb的文件</strong> <code>find / -size +10000k</code></li>
<li><strong>目录设置为750</strong> <code>find /www -type d -exec chmod 750</code></li>
<li><strong>文件为640</strong> <code>find /www ! -type d -exec chmod 640 {} \;</code></li>
<li><strong>将查找到的文件删除</strong> <code>find / -name \*.php -exec rm -i {} \;</code></li>
<li><strong>压缩处理</strong> <code>gzip passwd/gz -d passwd.gz</code> <em>gzip压缩，扩展名为.gz/解压缩扩展名为.gz的文件</em></li>
<li><strong>压缩处理</strong> <code>bzip2 passwd/bzip2 -d passwd.bz2</code> <em>bzip2压缩，扩展名为.bz2/解压缩扩展名为.bz2的文件</em></li>
<li><strong>压缩处理</strong> <code>tar zcvf hdxj/tar zxvf hdxj.tar.gz</code> <em>使用gzip压缩并打包/解压gzip文件</em></li>
<li><strong>压缩处理</strong> <code>tar jcvf hdxj/tar jxvf hdxj.tar.bz2</code> <em>使用bzip2压缩并打包/解压bz2文件</em></li>
<li><strong>压缩处理</strong> <code>-z/-j/-v/-c/-x</code> <em>以gzip方式压缩/以bzip2方式压缩/显示打包过程/新建打包文件/解包</em></li>
</ul>
<h1 id="vi编辑器"><a href="#vi编辑器" class="headerlink" title="vi编辑器"></a>vi编辑器</h1><ul>
<li><strong>打开文件</strong> <code>vim index.php</code></li>
<li><strong>输入内容</strong> <code>按i键</code></li>
<li><strong>返回标准模式</strong> <code>按esc</code></li>
<li><strong>保存退出</strong> <code>按:wq</code></li>
<li><strong>标准模式操作</strong> <code>i/I/a/A/o/O/esc</code> <em>i当前光标处插入/I行首插入/a光标下一个字符处插入/A行尾插入/o下一行插入/O上一行插入/返回标准模式</em></li>
<li><strong>标准模式操作</strong> <code>:w/:w!/:q/:q!/:wq!/:w [filename]/:! Command/:set nu</code> <em>保存/强制保存/退出不保存，强制退出/强制保存退出/别存为/临时执行命令/显示行号</em></li>
<li><strong>标准模式操作</strong> <code>nG(n为数字)/G/(:/word)/:?word/(:n1,n2s/word1/word2/g)(:n1,$s/word1/word2/gc)</code> <em>移动到第几行，如2G移动到第2行/移动到文件最后一行/向下搜索word的字符串/向上搜索word的字符串/从第n1行到第n2行搜索word1替换为word2/与上相同，只是在替换时询问</em></li>
<li><em>**</em> <code>dd/ndd/yy/nyy/p,P/u/ctrl+r</code> <em>剪切当前行/剪切向下n行/复制当前行/复制向下n行/p粘贴到下一行，P粘贴到上一行/撤销前一次操作/重做前一个操作</em></li>
<li><em>在通过vim进行文件编辑时，会生成以.swp为后缀的暂存文件，这样当我们意外中断时，可以用于恢复编辑内容。</em></li>
</ul>
<h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><ul>
<li><strong>准备</strong> <code>虚拟机设置网络连接方式为桥接</code></li>
<li><strong>·修改配置文件</strong> <code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code></li>
<li><p><strong>·修改内容(;为换行)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ONBOOT=yes;</span><br><span class="line">BOOTPROTO=STATIC;</span><br><span class="line">NETMASK=255.255.255.0(子网掩码);</span><br><span class="line">IPADDR=192.168.1.?(网络ip);</span><br><span class="line">GATEWAY=192.168.1.1(网关地址);</span><br><span class="line">DNS1=8.8.8.8(DNS服务器ip)</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>配置好后重启服务</strong> <code>service network restart</code></p>
</li>
<li><strong>测试网络</strong> <code>ping baidu.com</code></li>
<li><strong>清空防火墙规则</strong> <code>iptables -F</code></li>
<li><strong>储存规则</strong> <code>service iptables save</code></li>
<li><strong>·修改配置文件</strong> <code>vi /etc/selinux/config</code></li>
<li><strong>·修改内容</strong> <code>SELINUX=disabled</code></li>
<li><strong>链接主机，可以用软件</strong> <code>ssh root @192.168.1.?</code></li>
</ul>
<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><ul>
<li><strong>添加帐号</strong> <code>useradd ma</code></li>
<li><strong>添加帐号hd并且指定附加组为houdunwang</strong> <code>useradd –G houdunwang hd</code></li>
<li><strong>查看密码状态</strong> <code>passwd –S ma</code></li>
<li><strong>修改ma密码</strong> <code>passwd ma</code></li>
<li><strong>切换为root帐号su切换账号操作</strong> <code>su root</code></li>
<li><strong>锁定用户</strong> <code>usermod –L ma</code></li>
<li><strong>解锁用户</strong> <code>usermod –U ma</code></li>
<li><strong>设置帐号ma附加组到work</strong> <code>usermod –G work ma</code></li>
<li><strong>删除用户</strong> <code>userdel ma</code></li>
<li><strong>删除用户时连同用户家目录删除</strong> <code>userdel –r ma</code></li>
<li><strong>新增用户组</strong> <code>groupadd ma</code></li>
<li><strong>删除用户组</strong> <code>groupdel ma</code></li>
<li><strong>查看帐号信息</strong> <code>id ma</code></li>
</ul>
<h1 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h1><ul>
<li><code>drwxrwxr-x 2 ma ma 4096 3月 19 11:26 houdunwang.com</code> <em>文件权限 连接数 所有者 所属组 大小 修改时间 文件名</em></li>
<li><code>d/-/l</code> <em>目录/文件/链接</em></li>
<li><code>r/w/x</code> <em>可读/可写/可执行</em></li>
<li><em>权限每3个为一组(第1组rwx代码所有者/第2组rwx代表所属组/第3组rwx代表其他用户)</em></li>
<li><code>chown ma houdunwang</code> <em>改变文件houdunwang所有者为ma</em></li>
<li><code>chown ma:ma houdunwang</code> <em>改变文件houdunwang所有者为ma，所属组为ma</em></li>
<li><code>chown –R ma:ma hdphp</code> <em>改变目录hdphp及其下所有文件所有者为ma，所属组为ma</em></li>
<li><code>r(4)/w(2)/x(1)</code> <em>读权限/写权限/执行权限</em></li>
<li><code>4+2+1=7/4+0+1=5/4+0+0=4</code> <em>所有者/所属组/其他人(权限数字表示为754)</em></li>
<li><code>chmod 777 houdunwang</code> <em>将所有者、所属组、其他人的权限全部开启、即777</em></li>
<li><em>如果系统不支持ACL，修改配置文件/etc/fstab内容如下(/dev/sdb1 /www ext4 defaults,acl 0 0)</em></li>
<li><code>setfacl -m u:hdxj:rw /www/hd</code> <em>设置hdxj对hd有rw权限</em></li>
<li><code>getfacl /www/hd</code> <em>查看文件hd的权限</em></li>
<li><code>setfacl –m g:work:rwx shop</code> <em>work用户组对目录shop有rw权限</em></li>
<li><code>setfacl –b shop</code> <em>删除所有ACL设置</em></li>
<li><code>setfacl -m d:u:hdxj:rwx hdphp</code> <em>设置默认ACL权限(子目录会自动继承)</em></li>
<li><em>SUID(1.如果文件中的x权限位为s时，表示设置了SUID;2.SUID只作用于二进制程序,对目录无效，对shell脚本无效;3.在程序执行中执行者获得所有者权限;4.执行者要有x权限)</em></li>
<li><em>SGID(当对二进制程序设置SGID时，执行者获得程序;用户组权限对目录设置SGID，在此目录下用户组变身为目录组;用户在设置SGID目录下创建的文件组将为目录所在组)</em></li>
</ul>
<h1 id="磁盘操作"><a href="#磁盘操作" class="headerlink" title="磁盘操作"></a>磁盘操作</h1><ul>
<li><em>准备工作(虚拟机，设置加入磁盘)</em></li>
<li><code>du –a/du –ah/(du –sh /etc)/df -h/fdisk –l</code> <em>列出目录及子目录大小/以易识别单位显示大小/列出总大小/以易识别的单位查看分区情况/查看计算机中硬盘与分区信息</em></li>
<li><strong>磁盘分区</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb   //对sdb盘进行分区</span><br><span class="line">n                //新建分区</span><br><span class="line">p/l              //继续执行操作/新闻逻辑分区</span><br><span class="line">1                //新建主分区</span><br><span class="line">enter            //起始柱面，默认为1</span><br><span class="line">+2G              //结束柱面，填写磁盘大小</span><br><span class="line">e2               //创建扩展分区</span><br><span class="line">enter            //起始柱面，回车默认</span><br><span class="line">enter            //结束柱面，回车剩余空间</span><br><span class="line">p                //打印分区i信息</span><br><span class="line">w               //将分区写入磁盘</span><br><span class="line">mkfs –t ext4 /dev/sdb1    //格式化分区</span><br><span class="line">mount                     //查看挂载点</span><br><span class="line">mkdir /mnt/sdb1           //新建挂载目录</span><br><span class="line">mount /dev/sdb1 /mnt/sdb1    //挂在分区/dev/sdb1到/mnt/sdb1</span><br><span class="line">ls /mnt/sdb1                 //查看分区内容</span><br><span class="line">df                           //查看分区内容</span><br><span class="line">umount /dev/sdb1             //卸载分区</span><br><span class="line">/dev/sdb1 /www ext4 defaults 0 0      //分区自动挂载，修改/etc/fstab</span><br><span class="line">mount -a                              //命令是根据/etc/fstab设置挂载分区</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="软件安装-配置lamp环境-NTP时间服务器"><a href="#软件安装-配置lamp环境-NTP时间服务器" class="headerlink" title="软件安装(配置lamp环境)/NTP时间服务器"></a>软件安装(配置lamp环境)/NTP时间服务器</h1><ul>
<li><strong>安装wget命令</strong> <code>yum -y install wget</code></li>
<li><p><strong>iftop安装</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iftop是实时查看网络流量的工具，用于监控网络流量非常方便。</span><br><span class="line">安装wget命令:yum -y install wget</span><br><span class="line">下载软件:wget http://www.ex-parrot.com/~pdw/iftop/download/iftop-0.17.tar.gz</span><br><span class="line">安装环境:yum -y install gcc make flex byacc libpcap ncurses perl ncurses-devel libpcap-devel</span><br><span class="line">环境检测,在iftop的文件夹下进行:./configure --prefix=/usr/local/iftop</span><br><span class="line">编译安装:make &amp; make install</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>查看所有安装的vim软件</strong> <code>rpm –qa | egrep -i vi</code></p>
</li>
<li><strong>删除命令</strong> <code>rpm –e mysql</code></li>
<li><p><strong>RPM安装Mysql</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.sohu.com/mysql/MySQL-5.5/MySQL-server-5.5.38-1.rhel5.i386.rpm   //下载地址:service</span><br><span class="line">client wget http://mirrors.sohu.com/mysql/MySQL-5.5/MySQL-client-5.5.38-1.rhel5.i386.rpm  //下载地址</span><br><span class="line">service rpm -ivh MySQL-server-5.5.38-1.rhel5.i386.rpm  //安装</span><br><span class="line">client rpm -ivh MySQL-client-5.5.38-1.rhel5.i386.rpm  //安装</span><br><span class="line">Failed dependencies:/usr/bin/perl is needed by MySQL-server-5.5.36-1.rhel5.i386 执行：yum install -y perl  //错误处理:缺少perl包：error</span><br><span class="line">rpm -e --nodeps mysql-libs-5.1.71-1.el6.i686  //错误处理:与原先版本冲突: 查看系统:mysql rpm -qa | grep mysql 强制删除原版本mysql</span><br><span class="line">cp /usr/share/mysql/my-large.cnf /etc/my.cnf  //复制配置文件</span><br><span class="line">mysql: service mysql start  //启动Mysql</span><br><span class="line">mysql -uroot -p (新装的Mysql没有密码)  //连接Mysql</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>查看软件信息</strong> <code>yum info mysql</code></p>
</li>
<li><strong>搜索包含tree的软件</strong> <code>yum search tree</code></li>
<li><strong>安装tree软件</strong> <code>yum install mysql</code></li>
<li><strong>更新系统中的软件</strong> <code>yum update</code></li>
<li><strong>删除软件tree</strong> <code>yum erase tree</code></li>
<li><strong>安装apache</strong> <code>yum install httpd</code></li>
<li><strong>安装mysql</strong> <code>yum install mysql mysql-server</code></li>
<li><strong>安装php</strong> <code>yum install php php-mysql php-mbstring</code></li>
<li><strong>启动Apache</strong> <code>service httpd start</code></li>
<li><strong>启动mysql</strong> <code>service mysqld start</code></li>
<li><p><strong>NTP时间服务器</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ntp  //yum安装ntp</span><br><span class="line">chkconfig –level 35 ntpd on  //开启服务ntpd</span><br><span class="line">service ntpd restart  //开启服务</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>注意事项</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Web根目录默认在/var/www/html中</span><br><span class="line">关闭防火墙 service iptables stop</span><br><span class="line">关闭selinux vi /etc/selinux/config</span><br><span class="line">PHP代码默认放在/var/www/html</span><br><span class="line">开启PHP错误提示：1)vi /etc/php.ini 2)设置display_errors = On(530行左右)</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<h1 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h1><ul>
<li><strong>启动crontab服务</strong> <code>service crond start</code></li>
<li><strong>设置计划crontab任务</strong> <code>crontab -e</code></li>
<li><em>格式(</em> <em> </em> <em> </em> /command path)前5个分段表示时间：分 时 本月几号 月 星期 ;<em>代码任何时候; ,代码多个如时段写成5,9 指5点和9点; -代表区间如时段写成5-9指5，6，7，8，9点; /n表示间隔，如分段写成</em>/10指每隔10分钟*</li>
<li><em>定时备份数据库(cd /backup)创建backup.sh文件，并给他x权限btime=<code>date +%Y_%m_%d_%H</code>/usr/bin/mysqldump -uroot -padmin888 hd&gt;/backup/database/hd_$btime.sql</em></li>
</ul>
<h1 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h1><ul>
<li><strong>正常关闭进程</strong> <code>kill 2388</code></li>
<li><strong>强制关闭进程</strong> <code>kill -9 2011</code></li>
<li><strong>查看所有进程</strong> <code>ps aux | more</code></li>
<li><strong>top运行</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top运行中按?获得帮助()</span><br><span class="line">top运行中按P(按CPU使用率排序)</span><br><span class="line">top运行中按M(按内存占用排序)</span><br><span class="line">top运行中按N(按PID排序)</span><br><span class="line">top运行中按q(离开top)</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="系统服务"><a href="#系统服务" class="headerlink" title="系统服务"></a>系统服务</h1><ul>
<li><em>centos提供了service脚本，执行/etc/init.d/下的脚本来启动或关闭服务，service命令也是操作/etc/init.d/下的某个服务脚本</em></li>
<li><strong>开启httpd服务器</strong> <code>service httpd start</code></li>
<li><strong>关闭mysql服务器</strong> <code>service mysqld stop</code></li>
<li><strong>重起httpd服务</strong> <code>service httpd restart</code></li>
<li><strong>chkconfig开启服务</strong> <code>chkconfig --level 345 httpd on</code></li>
<li><strong>chkconfig关闭服务</strong> <code>chkconfig --level 345 httpd off</code></li>
<li><strong>查看服务启动状态</strong> <code>chkconfig --list httpd</code></li>
</ul>
<h1 id="网络命令-网络安全"><a href="#网络命令-网络安全" class="headerlink" title="网络命令/网络安全"></a>网络命令/网络安全</h1><ul>
<li><strong>列出所有端口 (包括监听和未监听的)</strong> <code>netstat –a</code></li>
<li><strong>列出所有 tcp 端口</strong> <code>netstat –at</code></li>
<li><strong>显示 PID 和进程名称</strong> <code>netstat –pat</code></li>
<li><strong>显示监听的端口(数字)</strong> <code>netstat -tanl</code></li>
<li><em>wget支持通过HTTP、HTTPS、FTP下载</em></li>
<li><em>iftop是实时查看网络流量的工具，用于监控网络流量非常方便。</em></li>
<li><p><strong>网络安全</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">iptable链 INPUT链/OUTPUT链    //进站数据包的规则/出站数据包规则</span><br><span class="line">处理方式 ACCEPT/DROP          //数据包允许通过其到达目的地。/数据包被拒绝不返回任何信息。</span><br><span class="line">iptables –L                   //查看防火墙</span><br><span class="line">iptables –F                   //清空防火墙规则</span><br><span class="line">iptables -A INPUT -s 192.168.1.106 -p TCP--dport 22 -j DROP  //禁止192.168.1.106通过ssh远程连接服务器</span><br><span class="line">		(-A)附加INPUT规则链</span><br><span class="line">		(-I)插入规则</span><br><span class="line">		(-s)来源IP，例子中就是当前登录ssh所用的电脑IP</span><br><span class="line">		(-d)目的地址，例子中就是服务器IP</span><br><span class="line">		(-D)删除规则</span><br><span class="line">		(-p)通信协议</span><br><span class="line">		(--dport)目的端口，例子中是ssh默认端口22</span><br><span class="line">		(-j)操作方式</span><br><span class="line">		(-i)数据包进入的网卡</span><br><span class="line">		(-o)流出数据包的网卡</span><br><span class="line">		(-l)查看防火墙规则</span><br><span class="line">		(--sprot)来源端口</span><br><span class="line">		(--dport)目标端口</span><br><span class="line">		(--line-number)带行号显示</span><br><span class="line">		(-p)默认规则</span><br><span class="line">		(-n)以数字形式显示</span><br><span class="line">iptables -P INPUT ACCEPT      //默认数据包为允许</span><br><span class="line">iptables –I INPUT –s 192.168.1.106 –j DROP      //不接收来自192.168.1.106数据包</span><br><span class="line">iptables -D INPUT 2      //删除第2条INPUT链规则</span><br><span class="line">iptable –I INPUT –s 192.168.1.106 –p tcp –dport 22 –j ACCCEPT      //将来自192.168.1.106的ssh服务放行</span><br><span class="line">iptables -I INPUT -i lo -j ACCEPT      //连接localhost的数据包允许</span><br><span class="line">iptable –A INPUT –s 192.168.1.106 –p icmp –j DROP      //禁止192.168.1.106的ping操作</span><br><span class="line">service iptables save     //保存iptables规则</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>WEB服务器防火墙规则</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">IPT=&quot;/sbin/iptables&quot;</span><br><span class="line">#删除所有规则</span><br><span class="line">$IPT -F</span><br><span class="line">#默认规则为全部禁止</span><br><span class="line">$IPT -P INPUT DROP</span><br><span class="line">$IPT -P FORWARD DROP</span><br><span class="line">$IPT -P OUTPUT DROP</span><br><span class="line">#设置当连接状态为RELATED和ESTABLISHED时，允许数据进入服务器</span><br><span class="line">$IPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">#设置外部客户端连接服务器端口80,22,21</span><br><span class="line">$IPT -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">$IPT -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">$IPT -A INPUT -p tcp -m tcp --dport 21 -j ACCEPT</span><br><span class="line">$IPT -A INPUT -p tcp -m tcp --dport 20 -j ACCEPT</span><br><span class="line">#允许外部ping服务器</span><br><span class="line">$IPT -A INPUT -p icmp -j ACCEPT</span><br><span class="line">#允许内部数据循回</span><br><span class="line">$IPT -A INPUT -i lo -j ACCEPT</span><br><span class="line">#设置状态为RELATED和ESTABLISHED的数据可以从服务器发送到外部</span><br><span class="line">$IPT -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">#允许访问外部dns服务器</span><br><span class="line">$IPT -A OUTPUT -p udp -m udp --dport 53 -j ACCEPT</span><br><span class="line">#允许内部数据循回</span><br><span class="line">$IPT -A OUTPUT -o lo -j ACCEPT</span><br><span class="line">#访问外部服务器80，22，21端口</span><br><span class="line">$IPT -A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">$IPT -A OUTPUT -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">$IPT -A OUTPUT -p tcp -m tcp --dport 21 -j ACCEPT</span><br><span class="line">$IPT -A OUTPUT -p tcp -m tcp --dport 20 -j ACCEPT</span><br><span class="line">#允许ping操作的数据输出</span><br><span class="line">$IPT -A OUTPUT -p icmp -j ACCEPT</span><br><span class="line">#保存重起iptables服务生效</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<h1 id="SAMBA共享服务"><a href="#SAMBA共享服务" class="headerlink" title="SAMBA共享服务"></a>SAMBA共享服务</h1><ul>
<li><strong>安装samba服务</strong> <code>yum –y install samba</code></li>
<li><strong>启动samba服务</strong> <code>service smb start</code></li>
<li><strong>关闭samba服务</strong> <code>service smb stop</code></li>
<li><em>修改配置文件(/etc/samba/smb.conf)访问samba需要验证，使用samba密码库 security=user</em></li>
<li><p><strong>修改配置文件(vi /etc/samba/smb.conf)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">`[xiama](共享名称)`</span><br><span class="line">comment = xiaoma(描述)</span><br><span class="line">path = /share/xiaoma(共享目录)</span><br><span class="line">writable = yes(可写)</span><br><span class="line">valid users = @admin(允许用户组)</span><br><span class="line">create mode = 0644(创建文件默认权限)</span><br><span class="line">directory mode = 0755(创建目录默认权限)</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><em>修改配置文件后，检查语法(testparm /etc/samba/smb.conf)</em></p>
</li>
<li><em>创建共享目录(/share/houdunwang)</em></li>
<li><em>添加组admin，即配置文件里面的组(groupadd admin)</em></li>
<li><em>添加帐号hdxj并加入附加组admin(useradd –G admin hdxj)</em></li>
<li><em>设置hdxj的samba密码(smbpasswd -a hdxj)</em></li>
<li><em>重起samba服务(service smb restart)</em></li>
<li><em>关闭selinux(setenforce 0(可以修改配置文件))</em></li>
<li><em>关闭防火墙(iptables –F)</em></li>
<li><em>清除window登录samba的记录命令(net use </em> /del)*</li>
</ul>
<h1 id="Apache服务器-Rewrite重写"><a href="#Apache服务器-Rewrite重写" class="headerlink" title="Apache服务器/Rewrite重写"></a>Apache服务器/Rewrite重写</h1><ul>
<li><strong>安装Apache</strong> <code>yum –y install httpd</code></li>
<li><strong>安装mysql</strong> <code>yum –y install mysql mysql-server</code></li>
<li><strong>安装php</strong> <code>yum -y install php php-mysql php-gd php-mbstring</code></li>
<li><strong>开启/关闭/重起</strong> <code>apachectl start/apachectl stop/apachectl restart</code></li>
<li><strong>主配置文件</strong> <code>/etc/httpd/conf/httpd.conf</code></li>
<li><strong>扩展配置文件</strong> <code>/etc/httpd/conf.d/*.conf</code> <em>当Apache启动时，会加载/etc/httpd/conf.d/目录中的所有以.conf结尾的文件，做为配置文件来使用</em></li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Listen 80      //监听端口,修改为8080,表示只能通过192.168.1.21:8080访问</span><br><span class="line">User apache          //Apache子进程所有者</span><br><span class="line">Group apache         //Apache子进程所属组</span><br><span class="line">DocumentRoot &quot;/var/www/html&quot;             //网站数据根目录</span><br><span class="line">ServerName localhost             //服务器的主机名通常这个值是自动指定的，推荐你显式的指定它以防止启动时出错</span><br><span class="line">DirectoryIndex index.html index.html.var             //网站默认主页，指定多个时，依次匹配</span><br></pre></td></tr></table></figure>
</li>
<li><p><em>**</em> <code>Options Indexes FollowSymLinks AllowOverride None</code> <em>Indexes如果访问的文件不存在，显示目录文件列表\FollowSymLinks在目录下创建a.html软链接，ln -s /ab/index.html /var/www/html/a.html;Options Indexes FollowSymLinks时软链接可用;Options Indexes –FollowSymLinks软链接不可用\AllowOverride 是否允许目录配置文件.htaccess有效ALL有效，None无效</em></p>
</li>
<li><code>主配置的NameVirtualHost *:80</code> <em>这行注释去掉(虚拟主机指在一台服务器上虚拟出多个网站)</em></li>
<li><p><strong>Rewrite重写,开启Rewrite模块</strong> <em>修改Apache主配置文件</em> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.删除LoadModule rewrite_module modules/mod_rewrite.so前#</span><br><span class="line">2.修改配置段为Options Indexes FollowSymLinks</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><em>想通过.htaccess也能设置Rewrite规则</em> <code>将网站目录配置段的“AllowOverride”改成“All”</code></p>
</li>
<li><strong>Rewrite重写</strong> <code>RewriteEngine</code> <em>打开或关闭运行时刻的重写引擎</em></li>
<li><strong>Rewrite重写</strong> <code>RewriteRule</code> <em>为重写引擎定义规则</em></li>
<li><strong>Rewrite重写</strong> <code>RewriteCond</code> <em>RewriteCond指令定义了一个规则的条件，在一个RewriteRule指令之前有一个或多 个RewriteCond指令。</em></li>
<li><strong>Rewrite重写</strong> <em>(‘-d’)是一个目录[directory]</em></li>
<li><strong>Rewrite重写</strong> <em>(‘-f’)是一个常规的文件[file])</em></li>
<li><p><strong>通过rewrite实现404定义</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f(不是一个文件)</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d(不是一个目录)</span><br><span class="line">RewriteRule .? /404.php `[L]`(条件满足执行404)</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Rewrite重写</strong> <em>([F]/[NC]/[L])强制URL为被禁止的 forbidden/忽略大小写 no case)/最后一个Url规则的重写last</em></p>
</li>
<li><p><strong>Rewrite重写(伪静态操作)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteRule ^/?news_(\d+).html news.php?nid=$1 [NC,L]</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Rewrite重写(防止图片盗链)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; !^$</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; !1992.168.1.78 [NC]</span><br><span class="line">RewriteRule .(jpg|png)$ logo.png</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Rewrite重写(隐藏网站主入口文件)RewriteEngine On</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">RewriteRule (.*) index.php?$1</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<h1 id="Mysql帐号权限"><a href="#Mysql帐号权限" class="headerlink" title="Mysql帐号权限"></a>Mysql帐号权限</h1><ul>
<li><strong>Mysql安全设置脚本</strong> <code>mysql_secure_installation</code></li>
<li><strong>查看帐号信息</strong> <code>select host,user,password from mysql.user</code></li>
<li><strong>设置密码</strong> <code>update mysql.user set password = password(&#39;admin888&#39;) where user=&#39;root&#39;;</code></li>
<li><strong>重新读授权表</strong> <code>flush privileges;</code></li>
<li><p><strong>忘记root密码</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf     //修改mysql配置文件</span><br><span class="line">skip-grant-tables       //在[mysqld]的段中加上</span><br><span class="line">service mysqld restart      //启动mysql服务</span><br><span class="line">update mysql.user set password = password(&apos;&apos;) where user = &apos;root&apos;;</span><br><span class="line">删除my.cnf中skip-grant-tables这一行</span><br><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><code>grant all on＊.* to &#39;hdxj&#39;@&#39;localhost&#39; identified by &#39;admin888&#39;;</code> <em>(添加帐号拥有所有权限)all 所有权限;on </em>.<em> 所有库中的所有表;‘hdxj’@’localhost’通过localhost主机登录的hdxj帐号;identified by设置密码;</em></p>
</li>
<li><strong>重新读授权表/添加用户后执行</strong> <code>flush privileges;</code></li>
<li><strong>删除匿名用户/重新读授权表</strong> <code>delete from mysql.user where user=&quot;&quot;;FLUSH PRIVILEGES;</code></li>
<li><strong>删除帐号/重新读授权表</strong> <code>DELETE FROM mysql.user where user = &#39;hdxj’;FLUSH PRIVILEGES;</code></li>
<li><strong>设置对表的创建、删除、修改权限</strong> <code>grant create,alter,drop on hd.* to &#39;hdxj&#39;@&quot;%&quot;(设置对表的创建、删除、修改权限)%代码任意值，以上例来说%代表任意来源</code></li>
<li><strong>添加查询hd数据库所有表权限</strong> <code>grant select on hd.* to hdxj@localhost IDENTIFIED BY &#39;admin888&#39;;</code></li>
</ul>
<h1 id="Mysql主从复制"><a href="#Mysql主从复制" class="headerlink" title="Mysql主从复制"></a>Mysql主从复制</h1><ul>
<li><p><strong>主从同步原理</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 主服务器验证连接。</span><br><span class="line">2. 主服务器为从服务器开启一个线程。</span><br><span class="line">3. 从服务器将主服务器日志的偏移位告诉主服务器。</span><br><span class="line">4. 主服务器检查该值是否小于当前二进制日志偏移位。</span><br><span class="line">5.  如果小于，则通知从服务器来取数据。</span><br><span class="line">6.  从服务器持续从主服务器取数据，直至取完，这时，从服务器线程进入睡眠，主服务器线程同时进入睡眠。</span><br><span class="line">7. 当主服务器有更新时，主服务器线程被激活，并将二进制日志推送给从服务器，并通知从服务器线程进入工作状态。</span><br><span class="line">8. 从服务器SQL线程执行二进制日志，随后进入睡眠状态。</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>安装实验环境</strong> <code>软件安装(配置lamp环境)/NTP时间服务器的RPM安装Mysql</code></p>
</li>
<li><strong>复制配置文件</strong> <code>cp /usr/share/mysql/my-large.cnf /etc/my.cnf</code></li>
<li><p><strong>修改my.cnf配置文件如下</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(启动二进制文件（已有）)log-bin=mysql-bin</span><br><span class="line">(服务器ID（已有）)server-id=1</span><br><span class="line">(binlog-do-db（新增加）)binlog-do-db = houdunwang#第一个 设置binlog记录的数据库，多个写多条</span><br><span class="line">(binlog-ignore-db)binlog-ignore-db = mysql#第一个 设置binlog不记录的数据库，多个写多条</span><br><span class="line">(设置binlog保存的天数)expire-logs-days=10 #binlog 保存10天(默认为30天)</span><br><span class="line">(远程复制文件)scp MySQL-client-5.5.38-1.rhel5.i386.rpm root@192.168.1.22:/root</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>GRANT创建用户并授权</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grant replication slave on *.* to &apos;slave&apos;@&apos;192.168.1.22&apos; identified by &apos;admin888&apos;;</span><br><span class="line">FLUSH PRIVILEGES(刷新授权表)</span><br><span class="line">详细说明</span><br><span class="line">replication slave 授权为从服务器复制操作</span><br><span class="line">On *.* 所有库中的所有表</span><br><span class="line">‘slave’@’ 127.0.0.23’通过127.0.0.23主机登录的slave帐号</span><br><span class="line">IDENTIFIED BY 设置密码</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>查看用户</strong> <code>select user,host from mysql.user;</code></p>
</li>
<li><strong>锁定主服务器所有表</strong> <code>mysql&gt; FLUSH TABLES WITH READ LOCK;</code></li>
<li><strong>备份所有数据库数据</strong> <code>[root@localhost mysql]# mysqldump -uroot -p houdunwang&gt;houdunwang.sql</code></li>
<li><strong>复制数据到slave</strong> <code>[root@localhost mysql]# scp houdunwang.sql root@192.168.1.22:/tmp</code></li>
<li><p><strong>修改从服务器my.cnf配置文件</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log-bin=mysql-bin 启动二进制文件（已有）</span><br><span class="line">server_id = 2(不能与主服务器相同)</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>重起Mysql服务器</strong> <code>service mysqld restart</code></p>
</li>
<li><strong>导入从主服务器复制的sql文件</strong> <code>mysql -uroot -p houdunwang</code></li>
<li><strong>注意</strong> <code>如果出现错误：ERROR! MySQL server PID file could not be found! 执行 rm -rf /var/lib/mysq/mysql-bin.index</code></li>
<li><strong>同步binlog日志</strong> <code>change master to master_host=‘192.168.1.21&#39;,master_user=&#39;slave&#39;,master_password=&#39;admin888&#39;,master_log_file=&#39;mysql-bin.000004&#39;,master_log_pos=120;</code></li>
<li><strong>开启从服务器(slave)同步</strong> <code>start slave;</code></li>
<li><strong>解除主服务器（Master)表锁定</strong> <code>mysql&gt; unlock tables;</code></li>
<li><strong>同步测试</strong> <em>在主服务器上插入数据，观察从服务器是否已经同步</em></li>
<li><strong>主服务器状态</strong> <code>SHOW MASTER STATUS</code></li>
<li><strong>从服务器列表</strong> <code>SHOW SAVE HOST</code></li>
<li><strong>查看状态—主服务器执行</strong> <code>show processlist</code></li>
<li><strong>查看状态—从服务器执行</strong> <code>show slave status\G</code></li>
</ul>
<h1 id="高并发网站解决MemCache"><a href="#高并发网站解决MemCache" class="headerlink" title="高并发网站解决MemCache"></a>高并发网站解决MemCache</h1><ul>
<li><strong>MemCache安装</strong> <code>yum –y install memcached.i686</code></li>
<li><strong>MemCache启动</strong> <code>memcached –m 128m -p 11211 -d -u root -P /tmp/memcached.pid -c 256</code></li>
<li><p><strong>起动参数</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-p tcp端口号 默认11211</span><br><span class="line">-m 最大内存大小 默认64M</span><br><span class="line">-d 做为守护进程在后台运行</span><br><span class="line">-c 最大并发连接数</span><br><span class="line">-P 保存Memcache的pid文件</span><br><span class="line">-l 监听服务器地址</span><br><span class="line">-u 如果以root用户启动MemCache必须加此选项</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>查看</strong> <code>netstat –anp| grep 11211</code></p>
</li>
<li><strong>关闭MemCache</strong> <code>kill -9 &#39;cat /tmp/memcached.pid&#39;</code></li>
<li><strong>中断进程</strong> <code>kill 进程号</code></li>
<li><strong>安装PHP的MemCache扩展</strong> <code>yum install -y php-pecl-memcache.i686</code></li>
<li><p><strong>在PHP中操作MemCache缓存</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$memcache = new Memcache;</span><br><span class="line">$memcache-&gt;connect(&apos;127.0.0.1&apos;,11211);</span><br><span class="line">$memcache-&gt;set(&quot;test&quot;,&quot;houdunwang.com&quot;,0,20);</span><br><span class="line">echo $memcache-&gt;get(&quot;test&quot;);</span><br><span class="line">$memcache-&gt;close();</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>连接Memcached(打开memcached服务端连接)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::connect ( string $host [, int $port [, int $timeout ]] )</span><br><span class="line">Host 主机地址</span><br><span class="line">Port memcached服务端监听端口</span><br><span class="line">Timeout 连接持续（超时）时间，单位秒。默认值1秒</span><br><span class="line">示例:</span><br><span class="line">$memcache = new Memcache;</span><br><span class="line">$memcache-&gt;connect(&apos;192.168.1.21&apos;, 11211);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>增加一个条目到缓存服务器</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::add ( string $key , mixed $var [, int $flag [, int $expire ]] )</span><br><span class="line">Key 变量名</span><br><span class="line">var 将要被存储的变量</span><br><span class="line">Flag 是否压缩</span><br><span class="line">Expire 失效时间。0表明永不过期</span><br><span class="line">$memcache_obj-&gt;add(’web&apos;, ’houdunwang&apos;, false, 30);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>替换已经存在的元素的值</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::replace ( string $key , mixed $var [, int $flag [, int $expire ]] )</span><br><span class="line">通过key来查找元素并替换其值。当key 对应的元素不存在时，Memcache::replace()返回FALSE。</span><br><span class="line">$memcache_obj-&gt;replace(&apos;web&apos;, &apos;houdunwang.com&apos;, false, 50);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>添加或替换一个key</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::set ( string $key , mixed $var [, int $flag [, int $expire ]] )</span><br><span class="line">$memcache_obj-&gt;set(&apos;web&apos;, &apos;houdunwang.com&apos;, false, 50);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>从服务端检回多个元素</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">string Memcache::get ( string $key [, int &amp;$flags ] )</span><br><span class="line">array Memcache::get ( array $keys [, array &amp;$flags ] )</span><br><span class="line">示例：</span><br><span class="line">$mem-&gt;add(&quot;a&quot;,&quot;aa&quot;);</span><br><span class="line">$mem-&gt;add(&quot;b&quot;,&quot;bb&quot;);</span><br><span class="line">print_r($mem-&gt;get(array(&quot;a&quot;,&quot;b&quot;)));</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>从服务端删除一个元素</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::delete ( string $key [, int $timeout ] )</span><br><span class="line">Key 要删除的元素的key。</span><br><span class="line">Timeout 删除该元素的执行时间。如果值为0,则该元素立即删除，如果值为30,元素会在30秒内被删除。</span><br><span class="line">示例</span><br><span class="line">$memcache_obj-&gt;delete(’webname&apos;, 10);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>删除已经存储的所有的元素</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::flush ( void )</span><br><span class="line">示例:</span><br><span class="line">$memcache_obj = new Memcache;</span><br><span class="line">$memcache_obj-&gt;connect(&apos;memcache_host&apos;, 11211);</span><br><span class="line">$memcache_obj-&gt;flush();</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>减小元素的值</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int Memcache::decrement ( string $key [, int $value = 1 ] )</span><br><span class="line">key元素value值减小多少。</span><br><span class="line">$mem-&gt;decrement(&quot;a&quot;,10);</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>增加一个元素的值</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int Memcache::increment ( string $key [, int $value = 1 ] )</span><br><span class="line">Memcache::increment()将指定元素的值增加value。如果指定的key 对应的元素不是数值类型并且不能被转换为数值， 会将此值修改为value. Memcache::increment() 不会在key对应元素不存在时创建元素</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>关闭memcache连接</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bool Memcache::close ( void )</span><br><span class="line">	Memcache::close()关闭到memcached服务端的连接。这个函数不会关闭持久化连接， 持久化连接仅仅会在web服务器关机/重启时关闭。</span><br><span class="line">	$memcache_obj = new Memcache;</span><br><span class="line">	$memcache_obj-&gt;connect(&apos;memcache_host&apos;, 11211);</span><br><span class="line">	$memcache_obj-&gt;close();</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>监控MemCache</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://livebookmark.net/memcachephp/memcachephp.zip</span><br><span class="line">unzip memcachephp.zip</span><br><span class="line">解压后修改相应配置项</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Memcached操作session</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改php.ini配置文件</span><br><span class="line">session.save_handler = memcache</span><br><span class="line">session.save_path = &quot;tcp://127.0.0.1:11211”</span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<h1 id="Coreseek全文检索"><a href="#Coreseek全文检索" class="headerlink" title="Coreseek全文检索"></a>Coreseek全文检索</h1><ul>
<li><strong>下载地址</strong> <code>http://www.coreseek.cn/news/14/52/</code></li>
<li><p><strong>安装mmseg</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Sphinx文件夹上传到/root目录</span><br><span class="line">安装相关软件：yum –y install make gcc g++ gcc-c++ libtool autoconf automake imake mysql-devel libxml2-devel libtool.i686 expat-devel php-devel</span><br><span class="line">tar zxvf /root/sphinx/coreseek-4.1-beta.tar.gz</span><br><span class="line">cd /root/sphinx/coreseek-4.1-beta/mmseg-3.2.14/</span><br><span class="line">./bootstrap #测试安装环境</span><br><span class="line">./configure --prefix=/usr/local/mmseg3</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>中文分词测试</strong> <code>/usr/local/mmseg3/bin/mmseg -d /usr/local/mmseg3/etc /root/sphinx/coreseek-4.1-beta/mmseg-3.2.14/src/t1.txt</code></p>
</li>
<li><p><strong>安装csft</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root/sphinx/coreseek-4.1-beta/csft-4.1</span><br><span class="line">sh buildconf.sh</span><br><span class="line">./configure --prefix=/usr/local/coreseek --without-unixodbc --with-mmseg --with-mmseg-includes=/usr/local/mmseg3/include/mmseg/ --with-mmseg-libs=/usr/local/mmseg3/lib/ --with-mysql</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Mysql数据分词实验</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用提供的建表sql.txt文件创建数据表</span><br><span class="line">复制配置文件：cp /root/sphinx/csft.conf /usr/local/coreseek/etc/</span><br><span class="line">创建索引文件：/usr/local/coreseek/bin/indexer --all</span><br><span class="line">分词搜索：/usr/local/coreseek/bin/search 小马</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>Coreseek配置说明</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">要连接的 SQL 服务器主机地址:sql_host = localhost</span><br><span class="line">SQL 服务器的 IP 端口(mysql 端口 3306, pgsql 端口 5432):sql_port = 3306</span><br><span class="line">sql_host 时使用的 SQL 用户名 :sql_user = test</span><br><span class="line">SQL 用户密码 :sql_pass =</span><br><span class="line">使用的 SQL 数据库 :sql_db = test</span><br><span class="line">主查询之前执行的预先查询 1.(sql_query_pre = SET NAMES=utf8)2.(sql_query_pre = SET SESSION query_cache_type=OFF)</span><br><span class="line">获取文档的主查询（数据源中只能有一个主查询）:sql_query = SELECT id, group_id, title, content FROM documents</span><br><span class="line">用来获取和显示记录详细信息, 仅用于调试目的 :sql_query_info= SELECT * FROM documents WHERE id=$id</span><br><span class="line">charset_dictpath=/usr/local/mmseg3/etc/必须设置，表示词典文件的目录，该目录下必须有uni.lib词典文件</span><br><span class="line">charset_type=zh_cn.utf-8必须设置，表示启用中文分词功能；否则中文分词功能无效，使用sphinx的其他处理模式。启用中文分词功能后，需要source数据源之中，读取的数据编码字符集为UTF-8，否则无法正确处理</span><br><span class="line">索引文件的路径和文件名path = /var/data/test1</span><br><span class="line">索引过程内存使用限制 mem_limit = 256M</span><br><span class="line">安装php扩展(安装libsphinxclient否则无法安装php的sphinx扩展)</span><br><span class="line">cd /root/sphinx/coreseek-4.1-beta/testpack/api/libsphinxclient</span><br><span class="line">./configure</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>安装php扩展(php的sphinx扩展安装)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">先关闭sphinx服务</span><br><span class="line">cd /root/sphinx/</span><br><span class="line">tar zxvf php-module-sphinx-1.3.2.tgz</span><br><span class="line">cd sphinx-1.3.2/</span><br><span class="line">phpize (如果不存在此命令，执行yum –y install php-devel安装)</span><br><span class="line">./configure --with-php-config=/usr/bin/php-config --with-sphinx</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>安装php扩展(修改PHP配置文件)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/php.d/</span><br><span class="line">cp gd.ini sphinx.ini</span><br><span class="line">修改内容为extension=sphinx.so</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>启动Sphinx</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/coreseek/bin/searchd -c /usr/local/coreseek/etc/csft.conf</span><br><span class="line">netstat -tlp</span><br><span class="line">#t:tcp l:Listen (监听)服务 p程序名</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>停止搜索服务</strong> <code>/usr/local/coreseek/bin/searchd -c /usr/local/coreseek/etc/csft.conf --stop</code></p>
</li>
<li><strong>已启动服务，要更新索引</strong> <code>/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft.conf --all --rotate</code></li>
<li><p><strong>PHP操作Sphinx函数</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SphinxClient::query ( string $query [, string $index = &quot;*&quot; [, string $comment = &quot;&quot; ]] )</span><br><span class="line">query 查询字符串.</span><br><span class="line">index 索引名称 (多个索引用逗号分割，或者为“*”表示全部索引)</span><br><span class="line">SphinxClient::setMatchMode ( int $mode )</span><br><span class="line">SPH_MATCH_ALL 匹配所有查询词（默认模式）</span><br><span class="line">SPH_MATCH_ANY 匹配查询词中的任意一个</span><br><span class="line">SPH_MATCH_PHRASE 将整个查询看作一个词组，要求按顺序完整匹配</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>PHP处理查询结果</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SphinxClient::buildExcerpts ( array $docs , string $index , string $words [, array $opts ] )</span><br><span class="line">$docs 要高亮的内容（数组类型，查找到的记录结果）</span><br><span class="line">$index 索引名称</span><br><span class="line">$words 高亮字符串（主是用户搜索的字符串）</span><br><span class="line">$opts 选项</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>实时索引更新 (重新建立索引)</strong> <code>/usr/local/coreseek/bin/indexer -c  /usr/local/coreseek/etc/csft.conf –all –rotate</code></p>
</li>
<li><strong>实时索引更新 (重建增量索引)</strong> <code>/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft.conf delta --rotate</code></li>
<li><p><strong>创建日志与脚本文件(创建日志文件)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /usr/local/coreseek/var/log/main.log</span><br><span class="line">touch /usr/local/coreseek/var/log/delta.log</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>创建日志与脚本文件(创建shell脚本)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/coreseek/sh/</span><br><span class="line">cd /usr/local/coreseek/sh</span><br><span class="line">touch main.sh</span><br><span class="line">touch dela.sh</span><br><span class="line">chmod a+x –R /usr/local/coreseek/sh/</span><br></pre></td></tr></table></figure></p>
</li>
<li><p><strong>实时索引更新(mainx.sh：主索引脚本)</strong> <code>#!/bin/sh/usr/local/coreseek/bin/indexer main--rotate&gt;&gt; /usr/local/sphinx/var/log/main.log</code></p>
</li>
<li><strong>实时索引更新(delta.sh#增量索引)</strong> <code>#!/bin/sh/usr/local/coreseek/bin/indexer delta --rotate&gt;&gt; /usr/local/sphinx/var/log/delta.log</code></li>
<li><strong>实时索引更新(计划任务)</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -e 来编辑 crontab文件</span><br><span class="line">*/5 * * * *  /bin/sh /usr/local/coreseek/sh/delta.sh</span><br><span class="line">30 3 * * * /bin/sh /usr/local/coreseek/sh/main.sh</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/学习/" rel="tag">#学习</a>
          
            <a href="/tags/服务器/" rel="tag">#服务器</a>
          
            <a href="/tags/linux/" rel="tag">#linux</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/28/sql常用语句整理/" rel="next" title="sql常用语句整理">
                <i class="fa fa-chevron-left"></i> sql常用语句整理
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/31/js打印数组-js打印对象的方法/" rel="prev" title="js常用方法整理">
                js常用方法整理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/05/29/linux基础知识整理/"
           data-title="linux基础知识整理" data-url="http://v5xiaoma.github.io/2016/05/29/linux基础知识整理/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://o7rtoe1nl.bkt.clouddn.com/myhead"
               alt="马阔" />
          <p class="site-author-name" itemprop="name">马阔</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#快捷操作"><span class="nav-number">1.</span> <span class="nav-text">快捷操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#系统命令"><span class="nav-number">2.</span> <span class="nav-text">系统命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#目录操作"><span class="nav-number">3.</span> <span class="nav-text">目录操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件操作"><span class="nav-number">4.</span> <span class="nav-text">文件操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#vi编辑器"><span class="nav-number">5.</span> <span class="nav-text">vi编辑器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络配置"><span class="nav-number">6.</span> <span class="nav-text">网络配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用户管理"><span class="nav-number">7.</span> <span class="nav-text">用户管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#权限控制"><span class="nav-number">8.</span> <span class="nav-text">权限控制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#磁盘操作"><span class="nav-number">9.</span> <span class="nav-text">磁盘操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#软件安装-配置lamp环境-NTP时间服务器"><span class="nav-number">10.</span> <span class="nav-text">软件安装(配置lamp环境)/NTP时间服务器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计划任务"><span class="nav-number">11.</span> <span class="nav-text">计划任务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#进程管理"><span class="nav-number">12.</span> <span class="nav-text">进程管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#系统服务"><span class="nav-number">13.</span> <span class="nav-text">系统服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络命令-网络安全"><span class="nav-number">14.</span> <span class="nav-text">网络命令/网络安全</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SAMBA共享服务"><span class="nav-number">15.</span> <span class="nav-text">SAMBA共享服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Apache服务器-Rewrite重写"><span class="nav-number">16.</span> <span class="nav-text">Apache服务器/Rewrite重写</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql帐号权限"><span class="nav-number">17.</span> <span class="nav-text">Mysql帐号权限</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql主从复制"><span class="nav-number">18.</span> <span class="nav-text">Mysql主从复制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高并发网站解决MemCache"><span class="nav-number">19.</span> <span class="nav-text">高并发网站解决MemCache</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Coreseek全文检索"><span class="nav-number">20.</span> <span class="nav-text">Coreseek全文检索</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">马阔</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"v5xiaoma"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("JzuUaOygs1mea1kmUOUnQpCv-gzGzoHsz", "nk4TlnWBP0YALliCIjy7y1VX");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
